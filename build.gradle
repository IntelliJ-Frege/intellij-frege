import org.jetbrains.grammarkit.tasks.*

plugins {
//    idea
    id 'java'
    id 'org.jetbrains.intellij' version '0.7.2'
    id 'org.jetbrains.grammarkit' version '2020.3.2'
//    id 'org.jetbrains.plugins.gradle'
}


apply plugin: 'org.jetbrains.intellij'
apply plugin: 'org.jetbrains.grammarkit'
//apply plugin: 'gradle-intellij-plugin'

group 'com.plugin.frege'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
//    implementation 'gradle.plugin.org.jetbrains.intellij.plugins:gradle-intellij-plugin:0.2.3'
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.6.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine'
}

intellij {
    version '2020.3'
    plugins = ['java', 'gradle', 'gradle-java']
    downloadSources true
}

task generateFregeLexer(type: GenerateLexer) {
    source = 'src/main/java/com/plugin/frege/lexer/FregeLexer.flex'
    targetDir = 'src/gen/com/plugin/frege/lexer/'
    targetClass = 'FregeLexer'
    purgeOldFiles = true
}

task generateFregeParser(type: GenerateParser) {
    source = 'src/main/java/com/plugin/frege/Frege.bnf'
    targetRoot = 'src/gen'
    pathToParser = '/com/plugin/frege/parser/FregeParser.java'
    pathToPsiRoot = '/com/plugin/frege/psi'
    purgeOldFiles = true
}

compileJava {
    dependsOn generateFregeParser
    dependsOn generateFregeLexer
}

patchPluginXml {
    changeNotes """
      Add change notes here.<br>
      <em>most HTML tags may be used</em>"""
}

test {
    useJUnitPlatform()
}

sourceSets.main.java.srcDirs 'src/gen'